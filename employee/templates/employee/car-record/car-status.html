{% extends "employee/employee-base.html" %}
{% load static %}
{% block content %}
<div class="container mt-5">
  <div class="page-inner">
    <div class="page-header">
      <h3 class="fw-bold mb-3">Car Status</h3>
      <ul class="breadcrumbs mb-3">
        <li class="nav-home">
          <a href="#">
            <img src="{% static 'img/dashboard.png' %}" alt="Home Icon" width="30" height="30">
          </a>
        </li>
        <li class="separator">
          <i class="icon-arrow-right"></i>
        </li>
        <li class="nav-item">
          <a href="#">Cars</a>
        </li>
        <li class="separator">
          <i class="icon-arrow-right"></i>
        </li>
        <li class="nav-item">
          <a href="#">Car Status</a>
        </li>
      </ul>
    </div>

    <!-- Car Status Progress Section -->
    <div class="card">
      <div class="card-body">
        <h4 class="card-title">Car Status Progress</h4>

        <!-- Progress Bar -->
        <div class="progress">
          <div class="progress-bar" id="statusProgress" role="progressbar" style="width: 0%" 
              aria-valuenow="0" aria-valuemin="0" aria-valuemax="100">
              0%
          </div>
      </div>
      
      <p class="mt-2">
          Total Cars: <span id="totalCars">{{ total_car }}</span> | 
          On Ride: <span id="onRide">{{ peding_car }}</span> | 
          Under Service: <span id="underService">{{ services }}</span> | 
          Cancelled: <span id="cancelled">{{ cancle_car }}</span>
      </p>
      
    </div>

    <!-- Car Status Overview Section -->

    <!-- Car Status Table -->
    

  </div>
  <div class="card">
    <div class="card-body">
      <h4 class="card-title mt-5" style="margin-left:400px">Confirm Car Bookings</h4>
  
      <!-- Table displaying booking details -->
      <div style="max-height: 400px; overflow-y: auto;"> <!-- Set max-height and overflow here -->
        <table class="table table-striped mt-3" id="carBookingTable">
          <thead>
            <tr>
              <th>Booking ID</th>
              <th>Car Model</th>
              <th>Pickup Location</th>
              <th>Pickup Date</th>
              <th>Drop Date</th>
              <th>Amount</th>
              <th>Booking Status</th>
            </tr>
          </thead>
          <tbody>
            {% for car in confirm %}
            <tr>
              <td>{{ car.id }}</td>
              <td>{{ car.car.make }}-{{ car.car.model }}</td>
              <td>{{ car.pickup_location }}-{{ car.city }}-{{ car.state }}-{{ car.country }}</td>
              <td>{{ car.pickup_date }} {{ car.pickup_time }}</td>
              <td>{{ car.drop_date }} {{ car.drop_time }}</td>
              <td>₹ {{ car.receipt_amount }}</td>
              <td><span style="font-size:20px" class="badge bg-warning">{% if car.booking_status == "confirm" %}Confirm{% endif %}</span></td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
  </div>
  
  <div class="card">
    <div class="card-body">
      <h4 class="card-title mt-5">Complete Car Bookings</h4>
      <div style="max-height: 400px; overflow-y: auto;"> <!-- Set max-height and overflow here -->

      <!-- Table displaying booking details -->
      <table class="table table-striped mt-3" id="carBookingTable">
        <thead>
          <tr>
            <th>Booking ID</th>
            <th>Car Model</th>
            <th>Pickup Location</th>
            <th>Pickup Date</th>
            <th>Drop Date</th>
            <th> Ammount </th>
            <th>Booking  Status</th>

          </tr>
        </thead>
        <tbody>
          {% for car in  complete_booking %}
          <!-- Example of confirmed car bookings data -->
          <tr>
            <td>{{car.car.number}}</td>
            <td>{{car.car.make}}-{{car.car.model}}</td>
            <td>{{car.pickup_location}}-{{car.city}}-{{car.state}}-{{car.country}}</td>
            <td>{{car.pickup_date}} {{car.pickup_time}}</td>
            <td>{{car.drop_date}} {{ car.drop_time}}</td>
            <td>₹ {{car.receipt_amount}}</td>
            <td><span style="font-size:20px" class="badge bg-success">{% if car.booking_status == "complete" %}Complete{% endif %}</span></td>
          </tr>
          {% endfor %}
         
        </tbody>
      </table>
    </div>
    </div>
  </div>
     
  </div>
</div>

{% endblock %}

{% block extra_scripts %}
  <script>
    $(document).ready(function () {
      // Get values from the span elements
      var totalCars = parseInt($("#totalCars").text().trim()) || 0;
      var onRideCars = parseInt($("#onRide").text().trim()) || 0;

      // Calculate the progress width based on total cars
      var progressWidth = totalCars > 0 ? (onRideCars / totalCars) * 100 : 0;

      // Update progress bar width and text
      $("#statusProgress")
          .css("width", progressWidth + "%")
          .attr("aria-valuenow", onRideCars)
          .text(onRideCars); // Display actual on-ride cars (e.g., "15")
  });
</script>
{% endblock %}
