{% extends "admindesk/admin-base.html" %}
{% load static %}

{% block content %}
<div class="container mt-5">
    <div class="page-inner">
        <div class="row justify-content-center">
            <!-- Booking Calendar -->
            <div class="col-md-6 d-flex justify-content-center">
                <div class="card shadow-lg p-3 w-100">
                    <h4 class="text-primary text-center">üìÖ Booking Calendar</h4>
                    <div id="bookingCalendar" style="min-height: 500px;"></div>
                </div>
            </div>

            <!-- Service Calendar -->
            <div class="col-md-6 d-flex justify-content-center">
                <div class="card shadow-lg p-3 w-100">
                    <h4 class="text-success text-center">üõ†Ô∏è Service Calendar</h4>
                    <div id="serviceCalendar" style="min-height: 500px;"></div>
                </div>
            </div>
        </div>
    </div>
</div>


{% endblock %}

{% block extra_scripts %}
<!-- FullCalendar CSS -->
<link href="https://cdn.jsdelivr.net/npm/fullcalendar@5.11.3/main.min.css" rel="stylesheet">

<!-- jQuery (Load First) -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>

<!-- FullCalendar JS -->
<script src="https://cdn.jsdelivr.net/npm/fullcalendar@5.11.3/main.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fullcalendar@5.11.3/locales-all.min.js"></script>

<script>
    $(document).ready(function () {
        function loadCalendar(calendarId, eventCategory) {
            let calendarEl = document.getElementById(calendarId);
    
            if (!calendarEl) {
                console.error("Calendar element not found:", calendarId);
                return;
            }
    
            let calendar = new FullCalendar.Calendar(calendarEl, {
                initialView: 'dayGridMonth',
                events: function(fetchInfo, successCallback, failureCallback) {
                    $.ajax({
                        url: "{% url 'get_events' %}",
                        dataType: "json",
                        success: function(data) {
                            
                            // Properly filter events
                            let filteredEvents = data.filter(event => {
                                if (eventCategory === "Booking") {
                                    return event.title.includes("Pickup") || event.title.includes("Drop");
                                } else if (eventCategory === "Service") {
                                    return event.title.includes("Start") || event.title.includes("Complete");
                                }
                                return false;
                            });
    
                            successCallback(filteredEvents);
                        },
                        error: function(xhr, status, error) {
                            console.error("Error fetching events:", error);
                            failureCallback(error);
                        }
                    });
                },
                headerToolbar: {
                    left: "prev,next today",
                    center: "title",
                    right: "dayGridMonth,timeGridWeek"
                }
            });
    
            calendar.render();
        }
    
        // Load both calendars with correct categories
        loadCalendar("bookingCalendar", "Booking");
        loadCalendar("serviceCalendar", "Service");
    });
</script>

{% endblock %}
