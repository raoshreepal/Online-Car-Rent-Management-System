{% extends "admindesk/admin-base.html" %}
{% load static %}
{% block content %}
<div class="container mt-5">
  <div class="page-inner">
    <h2>Car Services Management</h2>
    <div class="d-flex justify-content-between align-items-center mb-3">
      <button class="btn btn-primary" id="addServiceButton">Add Service</button>
      <div>
        <button class="btn btn-outline-secondary" style="display:none" id="clearFilter">Clear Filter</button>

        <button class="btn btn-outline-secondary" id="filterPending">Pending</button>
        <button class="btn btn-outline-secondary" id="filterComplete">Complete</button>
      </div>
    </div>
    <table class="table table-striped">
      <thead>
        <tr>
          <th>Car ID</th>
          <th>Image</th>
          <th>Services car</th>
          <th>Empployee</th>
          <th>Service Type</th>
          <th>Service Date</th>
          <th>Cost</th>
          <th>Status</th>
          <th>Confirm Date</th>
          <th>Actions</th>
        </tr>      
      </thead>

        <tbody id="serviceTableBody">
            {% for record in service_records %}
            <tr class="services-record {{record.status}}">
              <td>{{record.id}}</td>
              <td>
              <img src="{{ record.car.image.url }}" alt="{{ record.car.model }}" style="width: 50px; height: 50px; object-fit: cover; border-radius: 50%;" />
          </td>
          <td>{{ record.car.model }} - {{ record.car.number }}</td>
          <td>{{ record.employee.username }}</td>
          <td>{{ record.service_type }}</td>
          <td>{{ record.service_date }}</td>
          <td>
            â‚¹{{ record.cost }}</td>

            {% if record.status == "pending" %}
            <td class="service-status" data-id="{{ record.id }}" data-status="{{ record.status }}">
              <button class="btn btn-secondary" data-id="{{ record.id }}">{{ record.status }}</button>
          </td>
          
          {% else %}
            <td>{{ record.status }}</td>
          {% endif %}
          
            
         <!-- Modal for confirming and updating status -->
            <div class="modal fade" id="statusModal" tabindex="-1" role="dialog" aria-labelledby="statusModalLabel" aria-hidden="true">
              <div class="modal-dialog" role="document">
                <div class="modal-content">
                  <div class="modal-header">
                    <h5 class="modal-title" id="statusModalLabel">Confirm Service Status</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                      <span aria-hidden="true">&times;</span>
                    </button>
                  </div>
                  <div class="modal-body">
                    <p>Are you sure you want to confirm this service status?</p>
                    <form id="statusForm">
                      {% csrf_token %}

                      <!-- Hidden input to store the record ID -->
                      <input type="hidden" id="serviceRecordId"  />

                      <div class="form-group">
                        <label for="newStatus">Select Status:</label>
                        <select id="newStatus" class="form-control">
                          <option value="pending">Pending</option>
                          <option value="complete">Complete</option>
                        </select>
                      </div>

                      <div class="form-group mt-3">
                        <label for="statusDate">Select Date:</label>
                        <div class="input-group">
                          <button type="button" class="btn btn-secondary" id="setNow">Set to Now</button>
                          <input type="date"  required class="form-control" id="statusDate" />
                        </div>
                      </div>

                      <button type="submit" class="btn btn-primary mt-3" > Submit Status</button>
                    </form>
                  </div>
                </div>
              </div>
            </div>

            {% if record.complete_date %}
            <td style="text-align: center; color:green">{{ record.complete_date }}</td>
        {% else %}
            <td style="text-align: center;  color:red">Not Confirm</td>
        {% endif %}
        <td>
          <a href="#" class="delete-btn" data-id="{{ record.id }}">
              <i class="fas fa-trash text-danger" style="cursor: pointer;" title="Delete Car"></i>
          </a>
      </td>
      
      <!-- Delete Confirmation Popup -->
      <div id="confirmDeleteModal" class="modal" tabindex="-1" role="dialog">
          <div class="modal-dialog" role="document">
              <div class="modal-content">
                  <div class="modal-header">
                      <h5 class="modal-title">Confirm Deletion</h5>
                      <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                          <span aria-hidden="true">&times;</span>
                      </button>
                  </div>
                  <div class="modal-body">
                      <p>Are you sure you want to delete this car record?</p>
                  </div>
                  <div class="modal-footer">
                      <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
                      <button type="button" class="btn btn-danger" id="confirmDeleteBtn">Delete</button>
                  </div>
              </div>
          </div>
      </div>
      
        </tr>
      
      {% empty %}
      <tr>
          <td colspan="6" class="text-center">No service records available</td>
      </tr>
      {% endfor %}
    </table>
  </div>
</div>
<div class="modal fade" id="addServiceModal" tabindex="-1" role="dialog" aria-labelledby="addServiceModalLabel" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="addServiceModalLabel">Add Service</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
    
      <div class="modal-body">
        <form method="POST" action="{% url 'car_services_management' %}">
          {% csrf_token %}
          
          <!-- Render the form fields dynamically -->
          <div class="form-group row">
            <label for="car" class="col-sm-3 col-form-label">Car</label>
            <div class="col-sm-9">
              {{ form.car }}
            </div>
          </div>
        
          <div class="form-group row">
            <label for="employee" class="col-sm-3 col-form-label">Employee</label>
            <div class="col-sm-9">
              {{ form.employee }}
            </div>
          </div>
          
          <div class="form-group row">
            <label for="service_type" class="col-sm-3 col-form-label">Service Type</label>
            <div class="col-sm-9">
              {{ form.service_type }}
            </div>
          </div>
        
          <div class="form-group row">
            <label for="service_date" class="col-sm-3 col-form-label">Service Date</label>
            <div class="col-sm-9">
              {{ form.service_date }}
            </div>
          </div>
        
          <div class="form-group row">
            <label for="cost" class="col-sm-3 col-form-label">Cost</label>
            <div class="col-sm-9">
              {{ form.cost }}
            </div>
          </div>
        
          <div class="form-group row">
            <label for="description" class="col-sm-3 col-form-label">Description</label>
            <div class="col-sm-9">
              {{ form.description }}
            </div>
          </div>
        
          <div class="form-group row">
            <label for="status" class="col-sm-3 col-form-label">Status</label>
            <div class="col-sm-9">
              {{ form.status }}
            </div>
          </div>
        
          <div class="form-group row">
            <label for="complete_date" class="col-sm-3 col-form-label">Complete Date</label>
            <div class="col-sm-9">
              {{ form.complete_date }}
            </div>
          </div>
        
          <div class="form-group row">
            <div class="col-sm-9 offset-sm-3">
              <button type="submit" class="btn btn-primary">Submit</button>
            </div>
          </div>
        </form>
        
      </div>
    </div>
  </div>
</div>



<!-- Delete Confirmation Modal -->
<div class="modal fade" id="deleteServiceModal" tabindex="-1" aria-labelledby="deleteServiceModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="deleteServiceModalLabel">Confirm Delete</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <p>Are you sure you want to delete this service record?</p>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">No</button>
        <button type="button" class="btn btn-danger" id="confirmDeleteService">Yes</button>
      </div>
    </div>
  </div>
</div>
{% endblock %}

{% block extra_scripts %}
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

<script>
var car_services_status_url = "{% url 'services_status_url' record_id=0 %}";
var delete_car_url="{% url 'delete_services_car_url' record_id=0 %}";


</script>
<script src="{% static 'js/car-services-management.js'%}"></script>

{% endblock %}
