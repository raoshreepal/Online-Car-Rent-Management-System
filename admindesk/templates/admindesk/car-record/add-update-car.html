{% extends "admindesk/admin-base.html" %}
{% load static %}
{% block title %}Add and Update Cars{% endblock %}
{% block content %}
<div class="container mt-5">
    <div class="page-inner">
        <div class="page-header">
            <h3 class="fw-bold mb-3">Add and Update Cars</h3>
            <ul class="breadcrumbs mb-3">
                <li class="nav-home">
                    <a href="#">
                        <img src="{% static 'img/dashboard.png' %}" alt="Home Icon" width="30" height="30">
                    </a>
                </li>
                <li class="separator">
                    <i class="icon-arrow-right"></i>
                </li>
                <li class="nav-item">
                    <a href="#">Car Record</a>
                </li>
                <li class="separator">
                    <i class="icon-arrow-right"></i>
                </li>
                <li class="nav-item">
                    <a href="#">Add and Update Cars</a>
                </li>
            </ul>
        </div>

        <!-- Add Car Button -->
        <div class="mb-4">
            <button class="btn btn-primary" data-toggle="modal" data-target="#addCarModal" id="addCarButton">
                Add New Car
            </button>
        </div>

        <!-- Add Car Form Modal -->
        <div class="modal fade" id="addCarModal" tabindex="-1" role="dialog" aria-labelledby="addCarModalLabel" aria-hidden="true">
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="addCarModalLabel">Add New Car</h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="modal-body">
                        <form id="addCarForm">
                            <div class="form-group">
                                <label for="carNumber">Car Number</label>
                                <input type="text" class="form-control" id="carNumber" placeholder="Enter Car Number" required>
                            </div>
                            <div class="form-group">
                                <label for="make">Make</label>
                                <input type="text" class="form-control" id="make" placeholder="Enter Make" required>
                            </div>
                            <div class="form-group">
                                <label for="model">Model</label>
                                <input type="text" class="form-control" id="model" placeholder="Enter Model" required>
                            </div>
                            <div class="form-group">
                                <label for="year">Year</label>
                                <input type="number" class="form-control" id="year" placeholder="Enter Year" required>
                            </div>
                            <div class="form-group">
                                <label for="image">Car Image</label>
                                <input type="file" class="form-control-file" id="image">
                            </div>
                            <div class="form-group">
                                <label for="mileage">Mileage</label>
                                <input type="text" class="form-control" id="mileage" placeholder="Enter Mileage" required>
                            </div>
                            <div class="form-group">
                                <label for="status">Status</label>
                                <select class="form-control" id="status">
                                    <option>Available</option>
                                    <option>Unavailable</option>
                                    <option>Pending</option>
                                </select>
                            </div>
                            <button type="submit" class="btn btn-primary">Add Car</button>
                        </form>
                    </div>
                </div>
            </div>
        </div>

        <!-- Cars Table -->
        <div class="card mt-4">
            <div class="card-body">
                <h4 class="card-title mb-3">All Cars</h4>
                <table class="table table-striped">
                    <thead>
                        <tr>
                            <th>Car Number</th>
                            <th>Make</th>
                            <th>Model</th>
                            <th>Year</th>
                            <th>Image</th>
                            <th>Mileage</th>
                            <th>Status</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="carsTableBody">
                        <tr>
                            <td>CAR001</td>
                            <td>Toyota</td>
                            <td>Corolla</td>
                            <td>2022</td>
                            <td><img src="https://via.placeholder.com/100" alt="Car Image"></td>
                            <td>30,000 km</td>
                            <td>Available</td>
                            <td>
                                <button class="btn btn-info btn-sm" onclick="viewCarDetails('CAR001', 'Toyota', 'Corolla', '2022', '30,000 km', 'Available')">
                                    <i class="fas fa-eye"></i> View
                                </button>
                                <button class="btn btn-warning btn-sm" onclick="openUpdateCarModal('CAR001', 'Toyota', 'Corolla', '2022', '30,000 km', 'Available')">
                                    <i class="fas fa-edit"></i> Update
                                </button>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- View Car Modal -->
        <div class="modal fade" id="viewCarModal" tabindex="-1" role="dialog" aria-labelledby="viewCarModalLabel" aria-hidden="true">
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="viewCarModalLabel">Car Details</h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="modal-body">
                        <p><strong>Car Number:</strong> <span id="viewCarNumber"></span></p>
                        <p><strong>Make:</strong> <span id="viewMake"></span></p>
                        <p><strong>Model:</strong> <span id="viewModel"></span></p>
                        <p><strong>Year:</strong> <span id="viewYear"></span></p>
                        <p><strong>Mileage:</strong> <span id="viewMileage"></span></p>
                        <p><strong>Status:</strong> <span id="viewStatus"></span></p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Update Car Modal -->
        <div class="modal fade" id="updateCarModal" tabindex="-1" role="dialog" aria-labelledby="updateCarModalLabel" aria-hidden="true">
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="updateCarModalLabel">Update Car Details</h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="modal-body">
                        <form id="updateCarForm">
                            <div class="form-group">
                                <label for="updateCarNumber">Car Number</label>
                                <input type="text" class="form-control" id="updateCarNumber" required>
                            </div>
                            <div class="form-group">
                                <label for="updateMake">Make</label>
                                <input type="text" class="form-control" id="updateMake" required>
                            </div>
                            <div class="form-group">
                                <label for="updateModel">Model</label>
                                <input type="text" class="form-control" id="updateModel" required>
                            </div>
                            <div class="form-group">
                                <label for="updateYear">Year</label>
                                <input type="number" class="form-control" id="updateYear" required>
                            </div>
                            <div class="form-group">
                                <label for="updateMileage">Mileage</label>
                                <input type="text" class="form-control" id="updateMileage" required>
                            </div>
                            <div class="form-group">
                                <label for="updateStatus">Status</label>
                                <select class="form-control" id="updateStatus">
                                    <option>Available</option>
                                    <option>Unavailable</option>
                                    <option>Pending</option>
                                </select>
                            </div>
                            <button type="submit" class="btn btn-warning">Update Car</button>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_scripts %}
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>

<script>
    $(document).ready(function() {
        // Open the modal when the Add Car button is clicked
        $('#addCarButton').on('click', function() {
            $('#addCarModal').modal('show');
        });

        // Handle the Add Car form submission
        $('#addCarForm').on('submit', function(event) {
            event.preventDefault();

            // Collect form data (for demonstration, you can extend this logic)
            let carNumber = $('#carNumber').val();
            let make = $('#make').val();
            let model = $('#model').val();
            let year = $('#year').val();
            let mileage = $('#mileage').val();
            let status = $('#status').val();

            // You can add logic to send data to a server here (using Ajax, etc.)
            // For now, just show an alert and close the modal

            alert('Car added successfully!');
            $('#addCarModal').modal('hide');
            
            // Optionally, clear form fields
            $('#addCarForm')[0].reset();
        });
    });

    // View Car Details
    function viewCarDetails(carNumber, make, model, year, mileage, status) {
        document.getElementById('viewCarNumber').textContent = carNumber;
        document.getElementById('viewMake').textContent = make;
        document.getElementById('viewModel').textContent = model;
        document.getElementById('viewYear').textContent = year;
        document.getElementById('viewMileage').textContent = mileage;
        document.getElementById('viewStatus').textContent = status;
        $('#viewCarModal').modal('show');
    }

    // Open Update Car Modal with pre-filled data
    function openUpdateCarModal(carNumber, make, model, year, mileage, status) {
        document.getElementById('updateCarNumber').value = carNumber;
        document.getElementById('updateMake').value = make;
        document.getElementById('updateModel').value = model;
        document.getElementById('updateYear').value = year;
        document.getElementById('updateMileage').value = mileage;
        document.getElementById('updateStatus').value = status;
        $('#updateCarModal').modal('show');
    }

    // Handle Update Car Form Submission
    $('#updateCarForm').on('submit', function(event) {
        event.preventDefault();
        alert('Car Updated Successfully!');
        $('#updateCarModal').modal('hide');
    });
</script>
{% endblock %}
